namespace = tec_misc

planet_event = { # Ecoworld remove modifier
	id = tec_misc.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		tec_is_ecoworld = yes
		OR = {
			tec_is_arcology = yes
			tec_invalidates_ecoworld_project_comp = yes
		}
	}

	immediate = {
		remove_modifier = pm_tec_ecoworld_planet
	}
	
}

country_event = {
	id = tec_misc.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
	}

	immediate = {
		set_global_flag = tec_allow_cui
	}
}

namespace = tec_caching

# on_game_start
# on_yearly_pulse
event = { # General caching, run once 
	id = tec_caching.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {}
		every_galaxy_planet = {
			limit = {
				OR = {
					is_colony = yes
					is_colonizable = yes
				}
			}
			tec_cache_planet_type_triggers = yes
			if = {
				limit = {
					is_colony = yes
				}
				tec_cache_colony_triggers = yes
				tec_cache_capital_triggers = yes
			}
		}
		every_galaxy_pop = {
			tec_cache_shackled_triggers = yes
			tec_cache_pop_triggers = yes
		}
	}
}

# on_colonize
# on_planet_class_changes
planet_event = { # cache planet triggers
	id = tec_caching.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		tec_cache_planet_type_triggers = yes
	}
}

# on_colonize
# on_building_upgraded
planet_event = { # cache capital triggers
	id = tec_caching.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		tec_cache_capital_triggers = yes
	}
}

# on_tech
# on_policy_change
country_event = { # shackled pop cache triggers
	id = tec_caching.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_owned_pop = {
			tec_cache_shackled_triggers = yes
		}
	}
}

# on_monthly_pulse
event = {
	id = tec_caching.5 # montly
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			every_owned_planet = {
				tec_cache_colony_triggers = yes
			}
		}
		every_galaxy_pop = {
			tec_cache_pop_triggers = yes
		}
	}
}


namespace = tec_modifiers

country_event = { 
	id = tec_modifiers.1
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { from = { has_leader_flag = tec_added_starting_skill } }
		NOT = { has_country_flag = spawning_renowned_leader }
		NOT = { has_country_flag = tec_no_starting_skill_modification }
		exists = owner
		tec_is_default_country = yes
	}

	immediate = {
		FROM = {
			if = {
				limit = {
					is_pool_leader = yes
				}
				add_skill = value:tec_leader_starting_skill_add
			}
			else = {
				add_skill_without_trait_selection = value:tec_leader_starting_skill_add
			}
			set_leader_flag = tec_added_starting_skill
		}
	}
}

country_event = { 
	id = tec_modifiers.2
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { from = { has_leader_flag = tec_added_starting_traits } }
		NOT = { has_country_flag = spawning_renowned_leader }
		NOT = { has_country_flag = tec_no_starting_traits_modification }
		exists = owner
		tec_is_default_country = yes
	}

	immediate = {
		FROM = {
			while = {
				count = value:tec_leader_starting_traits_add
				add_trait_no_notify = "random_common"
				set_leader_flag = tec_added_starting_traits
			}
		}
	}
}

country_event = { 
	id = tec_modifiers.3
	hide_window = yes

	is_triggered_only = yes

	trigger = {
	}

	immediate = {
		every_owned_leader = {
			root = {
				country_event = {
					id = tec_modifiers.1
					scopes = {
						from = prev
					}
				}
				country_event = {
					id = tec_modifiers.2
					scopes = {
						from = prev
					}
				}
			}
		}
	}
}
