# - - - - - - - - - - - - - - - - - - - - - 
# Utopia On-Action Events #
# - - - - - - - - - - - - - - - - - - - - - 

namespace = utopia

@covenant_rank_1 = 20
@covenant_rank_2 = 50
@covenant_rank_3 = 90
@covenant_rank_4 = 150

### Withdrawal added when Unblissed
# utopia.91
# Hive Mind ruler gets Hive Mind trait to make them immortal	# MEMESIS Take a peek for gestalt motivations
# utopia.6000

# Hive Mind stops purging and sets rights for integrated species # MEMESIS take a peek for gestalt integration
# utopia.6001

#Purity government: purging pops yields unity
# utopia.180

#Purity government: purging pops yields unity
# utopia.181

### Withdrawal removed when Blissed
# utopia.90

### ASCENSION PERKS

# Engineered Evolution
# utopia.2700

# Evolutionary Mastery	# Memesis review
country_event = {
	id = utopia.2703
	title = "utopia.2703.name"
	desc = "utopia.2703.desc"
	picture = GFX_evt_genetic_modification
	show_sound = event_evolution_mastery

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		TRIGGER = {
			OR = {
				NOT = { is_hive_empire = yes }
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
		
	}

	option = {
		name = EXCELLENT
		#custom_tooltip = HIVE_ASSIMILATION_CITIZENSHIP_ENABLED
		trigger = {
			is_hive_empire = yes
			NOT = { has_valid_civic = civic_hive_devouring_swarm }
		}
	}
}

# The Flesh is Weak	# Overwritten by MEMESIS new aps
# utopia.2500

# A Cybernetic Revolution
# utopia.2501

# Notification for Other Nations
# utopia.2505

# Handle leader traits after species modification
# from: species
country_event = {
	id = utopia.2508
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		set_update_modifiers_batch = begin
		every_owned_leader = {
			limit = {
				species = {
					is_exact_same_species = from
				}
			}
			add_leader_traits_after_modification = yes
			remove_leader_traits_after_modification = yes
		}

		every_pool_leader = {
			limit = {
				species = {
					is_exact_same_species = from
				}
			}
			add_leader_traits_after_modification = yes
			remove_leader_traits_after_modification = yes
		}
		set_update_modifiers_batch = end
	}
}

# New Leaders Get Erudite Trait
# utopia.2509

# New Leaders Get Cyborg Trait
# utopia.2510
country_event = {
	id = utopia.2510
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		from = {
			species = { has_trait = trait_cybernetic }
		}
		# Our change, only give trait if cybernetic trait on exceptions if cybernetic path is started
		if = {
			limit = {
				tec_has_cybernetic_ascension_path_exception = yes
			}
			tec_has_cybernetic_ascension_path = yes
		}
	}

	immediate = {
		from = {
			add_trait_no_notify = leader_trait_cyborg
		}
	}
}

# Ruler gets normal class trait if one hasn't been assigned
# utopia.2511

# Synthetic Evolution
# utopia.2550

# The Synthetic Age # MEMESIS machine cult changes
country_event = {
	id = utopia.2551
	title = "utopia.2551.name"
	desc = "utopia.2551.desc"
	picture = GFX_evt_robot_assembly_plant
	show_sound = event_synthetic_evolution

	is_triggered_only = yes

	immediate = {
		set_country_flag = synthetic_empire
		if = {
			limit = {
				has_policy_flag = robots_outlawed
			}
			set_policy = {
				policy = robot_pop_policy
				option = robot_pops_allowed
				cooldown = yes
			}
		}
		if = {
			limit = {
				OR = {
					has_policy_flag = ai_servitude
					has_policy_flag = ai_outlawed
				}
			}
			set_policy = {
				policy = artificial_intelligence_policy
				option = ai_full_rights
				cooldown = yes
			}
		}
		if = {
			limit = {
				OR = {
					is_active_resolution = "resolution_divinity_silence_the_soulless"
					is_active_resolution = "resolution_divinity_a_defined_purpose"
				}
			}
			owner = {
				set_timed_country_flag = { flag = resolution_breached_synthetic_evolution days = 3600 }
			}
		}

		give_technology = { tech = tech_bio_reactor message = no }
		# Saves the species rights
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_utopian
					}
				}
				
			}
			root = {
				set_country_flag = tec_sa_utopian
			}
		}
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_academic_privilege
					}
				}
				
			}
			root = {
				set_country_flag = tec_sa_academic
			}
		}
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_chemical_bliss
					}
				}
				
			}
			root = {
				set_country_flag = tec_sa_chem
			}
		}
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_good
					}
				}
			}
			root = {
				set_country_flag = tec_sa_good
			}
		}
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_normal
					}
				}
			}
			root = {
				set_country_flag = tec_sa_normal
			}
		}
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_shared_burden
					}
				}
			}
			root = {
				set_country_flag = tec_sa_shared
			}
		}
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_stratified
					}
				}
			}
			root = {
				set_country_flag = tec_sa_stratified
			}
		}
		if = {
			limit = {
				owner_species = {
					has_living_standard = {
						type = living_standard_subsistence
					}
				}
			}
			root = {
				set_country_flag = tec_sa_poor
			}
		}

		# Executes the robomorphosis
		create_species = {
			# technically its applied at modification to avoid purifiers strange interactions, lets see...
			is_mod = yes
			name = this
			namelist = this
			plural = this
			class = "ROBOT"
			homeworld = root.species
			portrait = "default_robot"
			traits = {
				trait = "trait_mechanical"
			}

			effect = {
				if = { limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
					prev = {
						switch = {
							trigger = is_species_class
							HUM = { prev = { change_species_characteristics = { portrait = "sd_hum_robot" } }}
							MAM = { prev = { change_species_characteristics = { portrait = "sd_mam_robot" } }}
							REP = { prev = { change_species_characteristics = { portrait = "sd_rep_robot" } }}
							AVI = { prev = { change_species_characteristics = { portrait = "sd_avi_robot" } }}
							ART = { prev = { change_species_characteristics = { portrait = "sd_art_robot" } }}
							MOL = { prev = { change_species_characteristics = { portrait = "sd_mol_robot" } }}
							FUN = { prev = { change_species_characteristics = { portrait = "sd_fun_robot" } }}
							PLANT = { prev = { change_species_characteristics = { portrait = "sd_pla_robot" } }}
							LITHOID = { prev = { change_species_characteristics = { portrait = "lith_machine" } }}
							NECROID = { prev = { change_species_characteristics = { portrait = "nec_machine" } }}
							AQUATIC = { prev = { change_species_characteristics = { portrait = "aqu_machine" } }}
							TOX = { prev = { change_species_characteristics = { portrait = "tox_machine" } } }
						}
					}
				}

				rename_species = {
					prompt_country = root #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
					name_list = ascension_list
				}

				save_event_target_as = new_robotic_species
			}
		}

		every_owned_pop = {
			limit = {
				species = {
					OR = {
						has_trait = trait_cybernetic
						is_same_species = owner_main_species
					}
					
				}
			}
			change_species = event_target:new_robotic_species
		}

		# Extracheck, to be sure
		if = {
			limit = {
				has_policy_flag = robots_outlawed
			}
			set_policy = {
				policy = robot_pop_policy
				option = robot_pops_allowed
				cooldown = yes
			}
		}
		if = {
			limit = {
				OR = {
					has_policy_flag = ai_servitude
					has_policy_flag = ai_outlawed
				}
			}
			set_policy = {
				policy = artificial_intelligence_policy
				option = ai_full_rights
				cooldown = yes
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					OR = {
						has_trait = trait_cybernetic
						is_same_value = owner_species
					}
				}
			}
			change_species = event_target:new_robotic_species
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					OR = {
						has_trait = trait_cybernetic
						is_same_value = owner_species
					}
				}
				army_type = assault_army
			}
			modify_army = {
				name = random
				type = "robotic_army"
				species = event_target:new_robotic_species
			}
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					OR = {
						has_trait = trait_cybernetic
						is_same_value = owner_species
					}
				}
				army_type = defense_army
			}
			modify_army = {
				name = random
				type = "robotic_defense_army"
				species = event_target:new_robotic_species
			}
		}

		every_owned_leader = {
			limit = {
				OR = {
					has_trait = leader_trait_cyborg
					has_trait = leader_trait_synthetic
					species = {
						is_same_value = owner_species
					}
				}
			}
			change_species = event_target:new_robotic_species
			change_leader_portrait = species
		}
		every_envoy = {
			limit = {
				species = {
					NOT = {
						has_trait = trait_mechanical
					}
				}
			}
			change_species = event_target:new_robotic_species
			change_leader_portrait = species
		}
		every_pool_leader = {
			limit = {
				OR = {
					has_trait = leader_trait_cyborg
					has_trait = leader_trait_synthetic
					species = {
						is_same_value = owner_species
					}
				}
			}
			change_species = event_target:new_robotic_species
			change_leader_portrait = species
		}
		change_dominant_species = { species = event_target:new_robotic_species }

	#	event_target:new_robotic_species = {
	#		set_citizenship_type = {
	#			type = citizenship_full
	#		}
	#	}
	#
	#	event_target:new_robotic_species = {
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_utopian
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_utopian
	#				}
	#			}
	#			root = {
	#				remove_country_flag = tec_sa_utopian
	#			}
	#		}
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_academic
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_academic_privilege
	#				}
	#			}
	#			root = {
	#				remove_country_flag = tec_sa_academic
	#			}
	#		}
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_chem
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_chemical_bliss
	#				}
	#			}
	#			root = {
	#				remove_country_flag = tec_sa_chem
	#			}
	#		}
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_good
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_good
	#				}
	#			}
	#			root = {
	#				remove_country_flag = tec_sa_good
	#			}
	#		}
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_normal
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_normal
	#				}
	#			}
	#			root = {
	#				remove_country_flag = tec_sa_normal
	#			}
	#		}
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_shared
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_shared_burden
	#				}
	#			}
	#			
	#			root = {
	#				remove_country_flag = tec_sa_shared
	#			}
	#		}
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_stratified
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_stratified
	#				}
	#			}
	#			
	#			root = {
	#				remove_country_flag = tec_sa_stratified
	#			}
	#		}
	#		if = {
	#			limit = {
	#				root = {
	#					has_country_flag = tec_sa_poor
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_poor
	#				}
	#			}
	#			
	#			root = {
	#				remove_country_flag = tec_sa_poor
	#			}
	#		}
	#		if = {	#fallback
	#			limit = {
	#				root = {
	#					NOR = {
	#						has_country_flag = tec_sa_utopian
	#						has_country_flag = tec_sa_academic
	#						has_country_flag = tec_sa_chem
	#						has_country_flag = tec_sa_good
	#						has_country_flag = tec_sa_normal
	#						has_country_flag = tec_sa_shared
	#						has_country_flag = tec_sa_stratified
	#						has_country_flag = tec_sa_poor
	#					}
	#				}
	#			}
	#			species = {
	#				set_living_standard = {
	#					type = living_standard_normal
	#				}
	#			}
	#			
	#		}
	#	}

		every_owned_leader = {
			limit = {
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_synthetic
				}
			}
			add_trait_no_notify = leader_trait_synthetic
			remove_trait = leader_trait_cyborg
		}
		every_envoy = {
			limit = {
				species = { has_trait = trait_cybernetic }
			}
			change_species = event_target:new_robotic_species
			change_leader_portrait = species
		}
		every_pool_leader = {
			limit = {
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_synthetic
				}
			}
			
			add_trait_no_notify = leader_trait_synthetic
			remove_trait = leader_trait_cyborg
		}

		observer_event = { id = observer.4 }
		every_country = {
			limit = {
				is_ai = no
				NOT = { is_same_value = root }
				has_communications = root
			}
			country_event = { id = utopia.2555 days = 5 }
			country_event = { id = utopia.2556 days = 10 }
		}
		if = {
			limit = {
				any_country = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
					has_ethic = ethic_fanatic_spiritualist
					has_communications = root
					NOT = { is_same_value = root }
				}
			}
			random_country = {
				limit = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
					has_ethic = ethic_fanatic_spiritualist
					has_communications = root
					NOT = { is_same_value = root }
				}
				country_event = { id = utopia.2557 days = 15 }
			}
		}
		else = {
			random_country = {
				limit = {
					tec_is_default_country = yes
					has_ethic = ethic_fanatic_spiritualist
					NOT = {
						has_valid_civic = civic_tec_regular_machine_cult
					}
					has_communications = root
					NOT = { is_same_value = root }
				}
				country_event = { id = utopia.2557 days = 15 }
			}
			random_country = {
				limit = {
					tec_is_default_country = yes
					is_spiritualist = yes
					has_valid_civic = civic_tec_regular_machine_cult
					has_communications = root
					NOT = { is_same_value = root }
				}
				country_event = { id = utopia.25571 days = 15 }
			}
		}

		ROOT = {
			set_country_flag = synth_assimilation
		}
	}

	option = {
		name = "utopia.2551.a"
		custom_tooltip = SYNTH_ASSIMILATION_CITIZENSHIP_ENABLED
	}
}

# Notification for Other Nations
country_event = {
	id = utopia.2555
	title = "utopia.2550.name"
	desc = {
		text = utopia.2555.1.desc
		trigger = {
			OR = {
				NOR = {
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
				}
				AND = {
					OR = {
						has_ethic = ethic_fanatic_spiritualist
						has_ethic = ethic_spiritualist
					}
					has_valid_civic = civic_tec_regular_machine_cult
				}
			}
		}
	}
	desc = {
		text = utopia.2555.2.desc
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
			NOT = {
				has_valid_civic = civic_tec_regular_machine_cult
			}
		}
	}
	picture = GFX_evt_cybernetics
	show_sound = event_synthetic_evolution

	is_triggered_only = yes

	option = {
		name = "utopia.2555.a"
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
	option = {
		name = "utopia.2555.b"
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
			NOT = {
				has_valid_civic = civic_tec_regular_machine_cult
			}
		}
	}
	option = {
		name = "tec_utopia.2555.b"
		trigger = {
	#		OR = {
	#			has_ethic = ethic_fanatic_spiritualist
	#			has_ethic = ethic_spiritualist
	#		}
			has_valid_civic = civic_tec_regular_machine_cult		
		}
	}
}

# Diplomatic Announcement
country_event = {
	id = utopia.2556
	title = TRANSMISSION
	desc = "utopia.2556.desc"

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = from
		room = from.ruler
	}

	option = {
		name = utopia.2556.a
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_materialist
				has_ethic = ethic_materialist
			}

			NOT = { is_at_war_with = from }
		}
	}
	option = {
		name = utopia.2556.b
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
			NOT = {
				has_valid_civic = civic_tec_regular_machine_cult
			}
			NOT = { is_at_war_with = from }
		}
	}

	option = {
		name = tec_utopia.2556.b
		trigger = {
			has_valid_civic = civic_tec_regular_machine_cult
			
			NOT = { is_at_war_with = from }
		}
	}

	option = {
		name = utopia.2556.c
		trigger = {
			is_at_war_with = from
		}
	}
	option = {
		name = utopia.2556.d
		trigger = {
			NOR = {
				is_at_war_with = from
				has_ethic = ethic_fanatic_materialist
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
}

# Diplomatic Response (HIDDEN)
country_event = {
	id = utopia.2557
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		from = {
			country_event = { id = utopia.2558 }
		}
	}
}

# Diplomatic Response
country_event = {
	id = utopia.2558
	title = TRANSMISSION
	desc = "utopia.2558.desc"

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = from
		room = from.ruler
	}

	option = {
		name = utopia.2558.a
	}
}

#Machine cult fascination
# Diplomatic Response (HIDDEN)
country_event = {
	id = utopia.25571
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		from = {
			country_event = { id = utopia.25581 }
		}
	}
}

# Diplomatic Response
country_event = {
	id = utopia.25581
	title = TRANSMISSION
	desc = "utopia.25581.desc"

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = from
		room = from.ruler
	}

	option = {
		name = utopia.25581.a
	}
}


# New Leaders Get Synthetic Trait (Should also work on "normal" Synthetics)
country_event = {
	id = utopia.2560
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		OR = {
			AND = {
				from = {
					species = {
						has_trait = trait_mechanical
					}
				}
				# Evolved
					NOT = {	# For origins
						has_country_flag = tec_invalidates_synthetic_leader_trait
					}
				# /
			}
			AND = {
				is_machine_empire = yes
				# Evolved
					#has_tradition = tr_synthetics_finish
					OR = {
						has_country_flag = tec_synth_path_unlocked_tradition_1
						has_country_flag = tec_machine_synthetic_trait
					}
				# /
			}
		}
	}

	immediate = {
		from = {
			add_trait_no_notify = leader_trait_synthetic
		}
	}
}

# Ruler gets normal class trait if one hasn't been assigned
# utopia.2561

# Mind over Matter
# utopia.2600

# New Leaders Get Psionic Trait (Latent Psionic)
# utopia.2601

# Notification for other empires
# utopia.2602

# Psychic Identified
# utopia.2605

# Transcendence
# utopia.2650

# New Leaders Get Psionic Trait
# utopia.2651

# Notification for other empires
# utopia.2652

# Monthly Covenant Rank Increase
country_event = {
	id = utopia.2665
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			has_country_flag = composer_covenant_confirmed
			has_country_flag = eater_covenant_confirmed
			has_country_flag = instrument_covenant_confirmed
			has_country_flag = whisperers_covenant_confirmed
		}
		OR = {
			check_variable = {
				which = composer_covenant_rank
				value < 90
			}
			check_variable = {
				which = eater_covenant_rank
				value < 90
			}
			check_variable = {
				which = instrument_covenant_rank
				value < 90
			}
			check_variable = {
				which = whisperers_covenant_rank
				value < 90
			}
		}
	}

	immediate = {
		if = {			#Composer modifiers
			limit = {
				check_variable = {
					which = composer_covenant_rank
					value > 0
				}
			}
			change_variable = {
				which = composer_covenant_rank
				value = 0.03 
			}
			if = { #Civics liked
				limit = {
					OR = {
						has_valid_civic = civic_environmentalist
						is_catalytic_empire = yes
						tec_is_idyllic_bloom_empire = yes
						has_toxic_baths = yes
						# Evolved
						has_valid_civic = civic_tec_regular_eco_engineers
						has_valid_civic = civic_tec_regular_eco_keepers
						has_valid_civic = civic_tec_corporate_eco_reclamator_corp
						has_ethic = ethic_gestalt_preservation
						has_civic = civic_tec_machine_terraformers
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = 0.04
				}
			}
			if = { #Civics disliked
				limit = {
					is_relentless_industrialist_empire = yes
					check_variable = {
						which = composer_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = -0.02
				}
			}
			if = { #Ethics liked
				limit = {
					OR = {
						has_ethic = ethic_green
						has_ethic = ethic_xenophile
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = 0.03
				}
			}
			else_if = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_xenophile
						has_ethic = ethic_fanatic_green
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = 0.07
				}
			}
			
			if = { #Ethics disliked
				limit = {
					OR = {
						has_ethic = ethic_xenophobe
						has_ethic = ethic_industrial
					}
					check_variable = {
						which = composer_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = -0.02
				}
			}
			else_if = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_xenophobe
						has_ethic = ethic_fanatic_industrial
					}
					check_variable = {
						which = composer_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = -0.05
				}
			}
		
			if = { #Tradition liked
				limit = {
					OR = {
						has_tradition = tr_adaptability_finish
						has_tradition = tr_tec_outreach_finish
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = 0.06
				}
			}
			if = { #Acension Perks liked
				limit = {
					OR = {
						has_ascension_perk = ap_consecrated_worlds
						has_ascension_perk = ap_xeno_compatibility
						has_ascension_perk = ap_mastery_of_nature
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = 0.04
				}
			}
			if = { #Other things liked
				limit = {
					num_buildings = {
						type = building_clinic
						value = 0
					}
					num_buildings = {
						type = building_hospital
						value = 0
					}
					num_buildings = {
						type = building_hospital_3
						value = 0
					}
				}
				change_variable = {
					which = composer_covenant_rank
					value = 0.11
				}
			}
		}
		else_if = {		#Eater modifiers
			limit = {
				check_variable = {
					which = eater_covenant_rank
					value > 0
				}
			}
			change_variable = {
				which = eater_covenant_rank
				value = 0.03
			}
			if = { #Civics liked
				limit = {
					OR = {
						has_civic = civic_citizen_service
						has_civic = civic_fanatic_purifiers
						has_civic = civic_distinguished_admiralty
						has_civic = civic_naval_contractors
						has_civic = civic_barbaric_despoilers
						has_civic = civic_private_military_companies
						# Evolved
						has_civic = civic_tec_regular_stratocracy
						has_civic = civic_tec_regular_war_lords
						has_civic = civic_tec_regular_war_engineers
						has_civic = civic_tec_regular_secured_domain
						has_civic = civic_tec_corporate_parabellum_corp
						has_civic = civic_tec_corporate_competition_purifiers
						has_civic = civic_tec_corporate_militarybureau
						has_civic = civic_tec_corporate_navaltraders
						has_civic = civic_tec_regular_naval_traditions
						has_civic = civic_tec_regular_private_militaries
					}
				}
				change_variable = {
					which = eater_covenant_rank
					value = 0.04
				}
			}
			if = { #Civics disliked
				limit = {
					OR = {
						has_civic = civic_inwards_perfection
						has_civic = civic_agrarian_idyll
						# Evolved
						has_civic = civic_tec_regular_land_of_plenty
						has_civic = civic_tec_corporate_land_of_opportunity
						has_civic = civic_tec_regular_peacekeepers
					}
					check_variable = {
						which = eater_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = eater_covenant_rank
					value = -0.02
				}
			}
			if = { #Ethics liked
				limit = {
					has_ethic = ethic_militarist
				}
				change_variable = {
					which = eater_covenant_rank
					value = 0.03
				}
			}
			else_if = {
				limit = {
					has_ethic = ethic_fanatic_militarist
				}
				change_variable = {
					which = eater_covenant_rank
					value = 0.07
				}
			}
			if = { #Ethics disliked
				limit = {
					has_ethic = ethic_pacifist
					check_variable = {
						which = eater_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = eater_covenant_rank
					value = -0.02
				}
			}
			else_if = {
				limit = {
					has_ethic = ethic_fanatic_pacifist
					check_variable = {
						which = eater_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = eater_covenant_rank
					value = -0.05
				}
			}
			if = { #Tradition liked
				limit = {
					OR = {
						has_tradition = tr_supremacy_finish
						has_tradition = tr_tec_might_finish
					}
				}
				change_variable = {
					which = eater_covenant_rank
					value = 0.06
				}
			}
			if = { #Acension Perks liked
				limit = {
					OR = {
						has_ascension_perk = ap_galactic_force_projection
						has_ascension_perk = ap_interstellar_dominion
					}
				}
				change_variable = {
					which = eater_covenant_rank
					value = 0.04
				}
			}
			if = { #Other things liked
				limit = {
					is_at_war = yes
				}
				change_variable = {
					which = eater_covenant_rank
					value = 0.11
				}
			}
		}
		else_if = {		#Instrument modifiers
			limit = {
				check_variable = {
					which = instrument_covenant_rank
					value > 0
				}
			}
			change_variable = {
				which = instrument_covenant_rank
				value = 0.03
			}
			if = { #Civics liked
				limit = {
					OR = {
						has_civic = civic_aristocratic_elite
						has_civic = civic_feudal_realm
						has_civic = civic_slaver_guilds
						has_civic = civic_pleasure_seekers
						has_toxic_baths = yes
						has_civic = civic_indentured_assets
						has_civic = civic_corporate_hedonism

						# Evolved
						has_civic = civic_tec_regular_consumerism
						has_civic = civic_tec_regular_caste_system
						has_civic = civic_tec_regular_land_of_plenty
						has_civic = civic_tec_regular_immutable_hierarchy
						has_civic = civic_tec_regular_forced_reeducation
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = 0.04
				}
			}
			if = { #Civics disliked
				limit = {
					OR = {
						has_civic = civic_shared_burden
						# Evolved
						has_civic = civic_tec_regular_asceticism
						has_civic = civic_tec_regular_syndical
						has_civic = civic_tec_regular_social_prosperity
					}
					check_variable = {
						which = instrument_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = -0.02
				}
			}
			if = { #Ethics liked
				limit = {
					OR = {
						has_ethic = ethic_authoritarian
						has_ethic = ethic_elitist
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = 0.03
				}
			}
			else_if = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_authoritarian
						has_ethic = ethic_fanatic_elitist
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = 0.07
				}
			}
			if = { #Ethics disliked
				limit = {
					OR = {
						has_ethic = ethic_egalitarian
						has_ethic = ethic_pluralist
					}
					check_variable = {
						which = instrument_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = -0.02
				}
			}
			else_if = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_egalitarian
						has_ethic = ethic_fanatic_pluralist
					}
					check_variable = {
						which = instrument_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = -0.05
				}
			}
			if = { #Tradition liked
				limit = {
					OR = {
						has_tradition = tr_domination_finish
						has_tradition = tr_tec_control_finish
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = 0.06
				}
			}
			if = { #Acension Perks liked
				limit = {
					OR = {
						has_ascension_perk = ap_shared_destiny
						has_ascension_perk = ap_imperial_prerogative
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = 0.04
				}
			}
			if = { #Other things liked
				limit = {
					OR = {
						is_at_war = no
						ruler = {
							has_trait_tier1or2 = { TRAIT = leader_trait_substance_abuser }
						}
						any_owned_planet = {
							is_colony = yes
							has_designation = col_resort
						}
					}
				}
				change_variable = {
					which = instrument_covenant_rank
					value = 0.11
				}
			}
		}
		else_if = {		#Whisperers modifiers
			limit = {
				check_variable = {
					which = whisperers_covenant_rank
					value > 0
				}
			}
			change_variable = {
				which = whisperers_covenant_rank
				value = 0.03
			}
			if = { #Civics liked
				limit = {
					OR = {
						has_civic = civic_cutthroat_politics
						has_civic = civic_technocracy
						is_scavenger = yes
						has_civic = civic_criminal_heritage
						has_toxic_baths = yes
						has_civic = civic_shadow_council
						# Evolved
						has_civic = civic_tec_regular_cyber_dictatorship
						has_civic = civic_tec_regular_cult_personality
						has_civic = civic_tec_regular_labrats
						has_civic = civic_tec_regular_scientific_belief
						has_civic = civic_tec_regular_propagandistic
						has_civic = civic_tec_regular_occultist
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = 0.04
				}
			}
			if = { #Civics disliked
				limit = {
					OR = {
						has_civic = civic_inwards_perfection
						has_civic = civic_tec_regular_archivist
						has_civic = civic_tec_regular_universalism
					}
					check_variable = {
						which = whisperers_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = -0.02
				}
			}
			if = { #Ethics liked
				limit = {
					OR = {
						has_ethic = ethic_materialist
						has_ethic = ethic_capitalism
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = 0.03
				}
			}
			else_if = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_materialist
						has_ethic = ethic_fanatic_capitalism
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = 0.07
				}
			}
			if = { #Ethics disliked
				limit = {
					OR = {
						has_ethic = ethic_spiritualist
						has_ethic = ethic_socialism
					}
					check_variable = {
						which = whisperers_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = -0.02
				}
			}
			else_if = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_spiritualist
						has_ethic = ethic_fanatic_socialism
					}
					check_variable = {
						which = whisperers_covenant_rank
						value < 2
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = -0.05
				}
			}
			if = { #Tradition liked
				limit = {
					OR = {
						has_tradition = tr_subterfuge_finish
						has_tradition = tr_discovery_finish
						has_tradition = tr_tec_invention_finish
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = 0.06
				}
			}
			if = { #Acension Perks liked
				limit = {
					OR = {
						has_ascension_perk = ap_enigmatic_engineering
						has_ascension_perk = ap_technological_ascendancy
						has_ascension_perk = ap_tec_influential
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = 0.04
				}
			}
			if = { #Other things liked
				limit = {
					any_envoy = {
						has_envoy_task = {
							task = spy_network
						}
					}
				}
				change_variable = {
					which = whisperers_covenant_rank
					value = 0.11
				}
			}
		}
	}
}

country_event = {
	id = utopia.2682
	title = "utopia.2682.name"
	desc = "utopia.2682.desc"
	picture = GFX_evt_shroudwalker_enclave
	show_sound = event_psionic
	trackable = yes

	is_triggered_only = yes


	option = {
		name = "utopia.2682.a"
		default_hide_option = yes
		event_target:chosen_leader = {
			remove_all_negative_traits = yes

			# Composer.
			if = {
				limit = {
					ROOT = { has_country_flag = composer_covenant_rank_3 }
				}
				tec_leader_remove_psionic_traits = yes
			}

			# Eater.
			if = {
				limit = {
					ROOT = { has_country_flag = eater_covenant_rank_3 }
				}
				add_trait = leader_trait_eater_chosen
				tec_leader_remove_psionic_traits = yes
			}

			# Instrument.
			if = {
				limit = {
					ROOT = { has_country_flag = instrument_covenant_rank_3 }
				}
				add_trait = leader_trait_instrument_chosen
				tec_leader_remove_psionic_traits = yes
			}

			# Whisperers.
			if = {
				limit = {
					ROOT = { has_country_flag = whisperers_covenant_rank_3 }
				}
				add_trait = leader_trait_whisperers_chosen
				tec_leader_remove_psionic_traits = yes
			}
		}
	}
}

# The Shroud
# tec_psionic_path.110

# The Seance
# tec_psionic_path.111
